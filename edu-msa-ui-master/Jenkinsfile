pipeline {
    agent any

    environment {
        DOCKER_HOME = tool 'Docker'
        PATH = "$DOCKER_HOME/bin:$PATH"
    }

    stages {
        stage('Checkout') {
            steps {
                git url: 'https://github.com/jeongbami/gitops-repository.git', branch: 'main'
            }
        }
        stage('Docker Installation') {
            steps {
                sh '''
                    apt-get update
                    apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release
                    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
                    add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
                    apt-get update
                    apt-get install -y docker-ce docker-ce-cli containerd.io
                    groupadd docker
                    usermod -aG docker jenkins
                '''
            }
        }
        
      stage('Build and Push Image') {
            steps {
                script {
                    docker.build('seunghyejeong/dockerhubtest:1.0', '-f Dockerfile .')
                    withCredentials([usernamePassword(credentialsId: 'seunghyejeong', passwordVariable: 'tlqkfak0315!', usernameVariable: 'seunghyejeong')]) {
                        def image = docker.build("seunghyejeong/dockerhubtest:1.0")
                    docker.withRegistry('https://dockerhub.com', 'seunghyejeong') {
                        image.push()
                    }
                    }
                }
            }
        }
        }
       } // Add additional stages for testing and deploying your application
